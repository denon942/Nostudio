(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{396:function(t,e,n){"use strict";n.r(e);n(50),n(63),n(89);var o,c,l=n(25),r=n(189),d=n(391),m=n.n(d),v={name:"ChatBoard",data:function(){return{comments:[],comments_box:[],coment:"",APIKey:"79dca892-7921-4630-b281-eee96ef188e9",selectedAudio:"",audios:[],videos:[],localStream:null,peerId:"",calltoid:""}},methods:{send:function(){r.a.firestore().collection("room").doc("001").collection("comments").add({content:this.coment,createdAt:new Date,userid:"001"}).then(this.getCaht(),this.coment="")},onChange:function(){""!=this.selectedAudio&&this.connectLocalAudio()},connectLocalAudio:(c=Object(l.a)(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={audio:!!this.selectedAudio&&{deviceId:{exact:this.selectedAudio}}},t.next=3,navigator.mediaDevices.getUserMedia(e);case 3:n=t.sent,document.getElementById("my-video").srcObject=n,this.localStream=n;case 6:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)}),makeCall:function(){var t=this.peer.call(this.calltoid,this.localStream);this.connect(t)},connect:function(t){t.on("stream",(function(t){var e=document.getElementById("their-video");e.srcObject=t,e.play()}))},callOn:function(){""==this.peerId&&(this.localStream.getAudioTracks()[0].enabled=!0)},callOff:function(){""==this.peerId&&(this.localStream.getAudioTracks()[0].enabled=!1)},getCaht:(o=Object(l.a)(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.a.firestore().collection("room").doc("001").collection("comments").orderBy("createdAt","asc").limit(50).get().then((function(t){t.forEach((function(t){e.comments_box.push({content:t.data().content,createdAt:t.data().createdAt.toDate().toLocaleTimeString().toLocaleString()})}))}));case 2:this.comments=this.comments_box,console.log(this.comments_box),this.comments_box=[];case 5:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},watch:{},mounted:function(){var t=this;this.peer=new m.a({key:this.APIKey,debug:3}),this.peer.on("open",(function(){t.peerId=t.peer.id})),this.peer.on("call",(function(e){e.answer(t.localStream),t.connect(e)})),navigator.mediaDevices.enumerateDevices().then((function(e){for(var i=0;i!==e.length;++i){var n=e[i];"audioinput"===n.kind&&t.audios.push({text:n.label||"Microphone ".concat(t.audios.length+1),value:n.deviceId})}})),this.getCaht()},created:function(){}},h=n(39),f=n(68),_=n.n(f),y=n(245),C=n(368),w=n(390),x=n(186),k=n(187),A=n(116),I=n(82),O=n(380),S=n(386),component=Object(h.a)(v,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-list",{attrs:{"three-line":""}},[n("section",{staticClass:"container"},[n("div",[n("logo"),t._v(" "),n("video",{attrs:{id:"their-video",width:"200",autoplay:"",playsinline:""}}),t._v(" "),n("video",{attrs:{id:"my-video",muted:"true",width:"200",autoplay:"",playsinline:""},domProps:{muted:!0}}),t._v(" "),n("div",{staticClass:"main"},[n("h2",[t._v("Nuxt.js + SkyWayのビデオチャット")]),t._v("\n                マイク:\n                "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedAudio,expression:"selectedAudio"}],on:{change:[function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.selectedAudio=e.target.multiple?n:n[0]},t.onChange]}},[n("option",{attrs:{disabled:"",value:""}},[t._v("Please select one")]),t._v(" "),t._l(t.audios,(function(audio,e,o){return n("option",{key:o,domProps:{value:audio.value}},[t._v("\n                        "+t._s(audio.text)+"\n                    ")])}))],2),t._v(" "),n("div",[n("p",[t._v("Your id: "),n("span",{attrs:{id:"my-id"}},[t._v(t._s(t.peerId))])]),t._v(" "),n("p",[t._v("他のブラウザでこのIDをコールしましょう。")]),t._v(" "),n("h3",[t._v("コールする")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.calltoid,expression:"calltoid"}],attrs:{placeholder:"call id"},domProps:{value:t.calltoid},on:{input:function(e){e.target.composing||(t.calltoid=e.target.value)}}}),t._v(" "),n("button",{staticClass:"button--green",on:{click:t.makeCall}},[t._v("Call")]),t._v(" "),n("button",{staticClass:"button--green",on:{click:t.callOn}},[t._v("On")]),t._v(" "),n("button",{staticClass:"button--green",on:{click:t.callOff}},[t._v("Off")])])])],1)]),t._v(" "),n("v-list",{directives:[{name:"chat-scroll",rawName:"v-chat-scroll",value:{always:!1,smooth:!0,scrollonremoved:!0},expression:"{always: false, smooth: true, scrollonremoved:true}"}],staticClass:"overflow-y-auto",attrs:{"max-height":"470",height:"470",elevation:"0",tile:""}},t._l(t.comments,(function(e,o){return n("v-list-item",{key:o,staticClass:"black--text",attrs:{index:o}},[n("v-list-item-subtitle",{staticClass:"text--primary"},[t._v(t._s(e.content))]),t._v(" "),n("v-list-item-subtitle",[t._v("\n                "+t._s(e.createdAt)+"\n            ")])],1)})),1),t._v(" "),n("v-card",{staticClass:"grey display-1  pa-0 ma-0",attrs:{height:"50",elevation:"0",tile:""}},[n("v-row",{staticClass:"ma-0 pa-0",attrs:{justify:"end"}},[n("v-col",{staticClass:"ma-0 pa-0 py-4",attrs:{cols:"6"}},[n("v-text-field",{staticClass:"ma-0",attrs:{dense:"",label:"Message",color:"black"},model:{value:t.coment,callback:function(e){t.coment=e},expression:"coment"}})],1),t._v(" "),n("v-col",{staticClass:"ma-0 pa-0 py-1",attrs:{cols:"2"}},[n("v-btn",{staticClass:"pa-0 ma-0 ml-1",attrs:{tile:"",large:"",color:"teal",icon:""},on:{click:t.send}},[n("v-icon",{staticClass:"pa-0 ma-0",attrs:{color:"white"}},[t._v("mdi-send")])],1)],1)],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports;_()(component,{Logo:n(247).default}),_()(component,{VBtn:y.a,VCard:C.a,VCol:w.a,VIcon:x.a,VList:k.a,VListItem:A.a,VListItemSubtitle:I.b,VRow:O.a,VTextField:S.a})}}]);