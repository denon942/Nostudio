(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{351:function(t,e,n){"use strict";n.r(e);n(83);var o,c=n(27),r=n(76),l=(n(348),{name:"ChatBoard",data:function(){return{comments:[],comments_box:[],coment:"",userId:""}},methods:{send:function(){r.a.firestore().collection("users").doc(this.user_id).collection("room").doc(this.user_id).collection("comments").add({content:this.coment,createdAt:new Date,userName:this.user_name}).then(this.coment="")},getChat:(o=Object(c.a)(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.a.firestore().collection("users").doc(this.user_id).collection("room").doc(this.user_id).collection("comments").orderBy("createdAt","asc").limit(50).get().then((function(t){t.forEach((function(t){e.comments_box.push({content:t.data().content,createdAt:t.data().createdAt.toDate().toLocaleTimeString().toLocaleString(),userName:t.data().userName})}))}));case 2:this.comments=this.comments_box,console.log(this.comments_box),this.comments_box=[];case 5:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)}),onAuth:function(){this.$store.commit("onAuthStateChanged")}},computed:{user_name:function(){return this.$store.getters.user_name},user_id:function(){return this.$store.getters.user_id}},watch:{},mounted:function(){var t=this;""!=this.user_id&&r.a.firestore().collection("delivery").doc(this.user_id).onSnapshot((function(){r.a.firestore().collection("delivery").doc(t.user_id).get().then((function(e){t.deliveryId=e.data().peer,t.flg=e.data().flg,t.thumbnail=e.data().thumbnail,t.title=e.data().title,t.userId=e.data().user_id}))})),r.a.firestore().collection("users").doc(this.user_id).collection("room").doc(this.user_id).collection("comments").onSnapshot((function(){t.getChat()}))},created:function(){this.onAuth()}}),d=n(39),m=n(55),h=n.n(m),v=n(205),f=n(326),_=n(350),w=n(156),C=n(157),y=n(102),x=n(74),A=n(338),I=n(344),component=Object(d.a)(l,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-list",{attrs:{"three-line":"","min-width":"320"}},[n("v-list",{directives:[{name:"chat-scroll",rawName:"v-chat-scroll",value:{always:!1,smooth:!0,scrollonremoved:!0},expression:"{always: false, smooth: true, scrollonremoved:true}"}],staticClass:"overflow-y-auto",attrs:{"max-height":"470",height:"470",elevation:"0",tile:""}},t._l(t.comments,(function(e,o){return n("v-list-item",{key:o,staticClass:"black--text",attrs:{index:o}},[n("v-list-item-subtitle",{staticClass:"subtitle-1"},[n("span",{staticClass:"blue--text font-weight-bold"},[t._v(t._s(e.userName))]),t._v(" "),n("span",{staticClass:"font-weight-thin"},[t._v(t._s(e.createdAt)+":")]),t._v("\n                "+t._s(e.content)+"\n            ")])],1)})),1),t._v(" "),n("v-card",{staticClass:"grey display-1  pa-0 ma-0",attrs:{height:"50",elevation:"0",tile:""}},[n("v-row",{staticClass:"ma-0 pa-0",attrs:{justify:"center"}},[n("v-col",[n("v-text-field",{staticClass:"ma-0",attrs:{dense:"",label:"Message",color:"black"},model:{value:t.coment,callback:function(e){t.coment=e},expression:"coment"}})],1),t._v(" "),n("v-col",{staticClass:"ma-0 pa-0 py-1",attrs:{cols:"2"}},[n("v-btn",{staticClass:"pa-0 ma-0 ml-1",attrs:{tile:"",large:"",color:"teal",icon:""},on:{click:t.send}},[n("v-icon",{staticClass:"pa-0 ma-0",attrs:{color:"white"}},[t._v("mdi-send")])],1)],1)],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports;h()(component,{VBtn:v.a,VCard:f.a,VCol:_.a,VIcon:w.a,VList:C.a,VListItem:y.a,VListItemSubtitle:x.b,VRow:A.a,VTextField:I.a})},357:function(t,e,n){"use strict";n.r(e);n(83);var o,c=n(27),r=n(76),l=n(348),d=n.n(l),m=n(351),h={name:"ChatBoard",data:function(){return{comments:[],comments_box:[],coment:"",APIKey:"79dca892-7921-4630-b281-eee96ef188e9",selectedAudio:"",audios:[],videos:[],localStream:null,peerId:"",calltoid:"",flg:!1,thumbnail:"",title:"",callFlg:!0}},methods:{send:function(){r.a.firestore().collection("users").doc(items.user_id).collection("room").doc(items.user_id).collection("comments").add({content:this.coment,createdAt:new Date,userName:this.user_name}).then(this.getCaht(),this.coment="")},onChange:function(){""!=this.selectedAudio&&this.connectLocalAudio()},connectLocalAudio:(o=Object(c.a)(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={audio:!!this.selectedAudio&&{deviceId:{exact:this.selectedAudio}}},t.next=3,navigator.mediaDevices.getUserMedia(e);case 3:n=t.sent,this.localStream=n;case 5:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)}),makeCall:function(){},connect:function(t){t.on("stream",(function(t){var e=document.getElementById("their-video");e.srcObject=t,e.play()}))},callOn:function(){""!=this.peerId&&(this.localStream.getAudioTracks()[0].enabled=!0,this.flg=!1)},callOff:function(){""!=this.peerId&&(this.localStream.getAudioTracks()[0].enabled=!1,this.flg=!0)},onAuth:function(){this.$store.commit("onAuthStateChanged")},openOrClose:function(a){this.$store.commit("openOrClose",a),this.callFlg=!this.callFlg,0==a&&(window.location.href="/user/mypage",this.peer.destroy())},image:function(){var t=this;""!=this.user_id&&r.a.firestore().collection("delivery").doc(this.user_id).onSnapshot((function(){r.a.firestore().collection("delivery").doc(t.user_id).get().then((function(e){t.thumbnail=e.data().thumbnail,t.title=e.data().title}))}))}},watch:{user_id:function(){""!=this.user_id&&(r.a.firestore().collection("delivery").doc(this.user_id).set({peer:this.peerId},{merge:!0}),this.image())},peerId:function(){""!=this.user_id&&r.a.firestore().collection("delivery").doc(this.user_id).set({peer:this.peerId},{merge:!0})}},mounted:function(){var t=this;this.peer=new d.a({key:this.APIKey,debug:3}),this.peer.on("open",(function(){t.peerId=t.peer.id})),this.peer.on("call",(function(e){e.answer(t.localStream),t.connect(e)})),navigator.mediaDevices.enumerateDevices().then((function(e){for(var i=0;i!==e.length;++i){var n=e[i];"audioinput"===n.kind&&t.audios.push({text:n.label||"Microphone ".concat(t.audios.length+1),value:n.deviceId})}})),this.image()},computed:{user_id:function(){return this.$store.getters.user_id},user_name:function(){return this.$store.getters.user_name}},components:{Chat:m.default},created:function(){this.onAuth()}},v=n(39),f=n(55),_=n.n(f),w=n(205),C=n(326),y=n(350),x=n(340),A=n(156),I=n(136),k=n(338),component=Object(v.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",[n("v-row",{attrs:{justify:"center"}},[n("v-col",{attrs:{cols:"12",lg:"8",md:"8",sm:"12",xs:"12"}},[n("v-card",{staticClass:"pa-2"},[n("v-row",{attrs:{justify:"center"}},[n("v-col",{attrs:{cols:"auto"}},[n("v-img",{attrs:{"max-height":"400","max-width":"600",src:t.thumbnail}}),t._v(" "),n("audio",{attrs:{id:"their-video",width:"200",autoplay:"",playsinline:""}}),t._v(" "),n("audio",{attrs:{id:"my-video",muted:"true",width:"200",autoplay:"",playsinline:""}})],1)],1)],1),t._v(" "),n("h2",[t._v("タイトル名："+t._s(t.title)+" ")]),t._v(" "),n("v-row",[n("v-col",{attrs:{cols:"auto"}},[t._v("\n                    マイク:\n                    "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedAudio,expression:"selectedAudio"}],on:{change:[function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.selectedAudio=e.target.multiple?n:n[0]},t.onChange]}},[n("option",{attrs:{disabled:"",value:""}},[t._v("Please select one")]),t._v(" "),t._l(t.audios,(function(audio,e,o){return n("option",{key:o,domProps:{value:audio.value}},[t._v("\n                            "+t._s(audio.text)+"\n                        ")])}))],2)]),t._v(" "),n("v-col",{attrs:{cols:"auto"}},[t.flg?n("v-btn",{staticClass:"button--green",on:{click:t.callOn}},[n("v-icon",[t._v("mdi-microphone-off")])],1):n("v-btn",{staticClass:"button--green",on:{click:t.callOff}},[n("v-icon",[t._v("mdi-microphone")])],1),t._v(" "),t.callFlg?n("v-btn",{on:{click:function(e){return t.openOrClose(t.callFlg)}}},[t._v("\n                        配信開始\n                    ")]):n("v-btn",{on:{click:function(e){return t.openOrClose(t.callFlg)}}},[t._v("\n                        配信停止\n                    ")])],1)],1)],1),t._v(" "),n("v-col",{attrs:{cols:"12",lg:"4",md:"4",sm:"12",xs:"12"}},[n("Chat")],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports;_()(component,{Chat:n(351).default}),_()(component,{VBtn:w.a,VCard:C.a,VCol:y.a,VContainer:x.a,VIcon:A.a,VImg:I.a,VRow:k.a})}}]);